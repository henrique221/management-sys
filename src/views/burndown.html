{% extends "./layout/main.html" %} {% block content %}
<title>Burndown</title>
<script src="/static/assets/js/Chart.bundle.js"></script>
<script src="/static/assets/js/utils.js"></script>

<style>
    canvas {
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
    }
</style>
<body>
    
    <div class="container-fluid" style='width: 90%'>
    <div class="container-fluid d-flex justify-content-center">
        <div class="w-100 p-3">
            <span class="d-flex justify-content-end">
                <div style="position:absolute; padding-top: 30px; padding-right: 5px">
                    {% include "modal.html" %}
                </div>
            </span>
            <canvas id="canvas"></canvas>
        </div>
        </div>
        <br>
        <form action="" method="POST">
            <div class='input-group'>
                <div class='container-fluid'>
                    <div>
                        <span class="row d-flex justify-content-center" style="width:100%; flex-direction:column">
                        <div class="form-group row d-flex justify-content-center">
                            <label for='date' class="col-sm-2 col-form-label">Date</label>
                            <div class='col-sm-5'>
                                <input class="form-control" id='date' name='date' type='date' required>
                            </div>
                        </div>
                        <div class="form-group row d-flex justify-content-center">
                            <label for='remaining' class="col-sm-2 col-form-label">Remaining</label>
                            <div class='col-sm-5'>
                                <input class="form-control" id='remaining' name='remaining' type='number' placeholder='Remaining tasks' required>
                            </div>
                        </div>
                        <div class="form-group row d-flex justify-content-center">
                            <label for='bugs' class="col-sm-2 col-form-label">Bugs</label>
                            <div class='col-sm-5'>
                                <input class="form-control" id='bugs' name='bugs' type='number' placeholder='Bugs' required>
                            </div>
                        </div>
                        <div class="form-group row d-flex justify-content-center">
                            <label for='extra' class="col-sm-2 col-form-label">Extra</label>
                            <div class='col-sm-5'>
                                <input class="form-control" id='extra' name='extra' type='number' placeholder='Extra tasks' required>
                            </div>
                        </div>
                        <div class="form-group row d-flex justify-content-center">
                            <label for='improvements' class="col-sm-2 col-form-label">Improvements</label>
                            <div class='col-sm-5'>
                                <input class="form-control" id='improvements' name='improvements' type='number' placeholder='Improvements' required>
                            </div>
                        </div>
                            <div class="d-flex justify-content-end">
                                <button class="btn btn-primary mb-2" id='submit'>Enviar</button>
                            </div>
                    </span>
                    </div>
                    </div>
                </div>
            </div>
        </form>
    
</div>

    <script>        
        var DAYS = [];
        var DATAS = [];
        var day = new Date();
        

        var dbBugs = []
        var dbRemaining = []
        var dbImprovements = []
        var dbExtras = []
        var dbIdeal = []
        
        {% for dado in items %}
            dbRemaining.push({{ dado.remaining_tasks }})
            dbBugs.push({{ dado.bugs }})
            dbImprovements.push({{ dado.improvements }})
            dbExtras.push({{ dado.extra_tasks }})
        {% endfor %}

        {% for dado in ideal %}
            dbIdeal.push({{dado}})
        {% endfor %}
        
        let month = day.toLocaleDateString('pt-br', {
            month: '2-digit',
        })

        document.getElementById('date').setAttribute('value', '{{dateMoment}}');
        var i = 0
        {% for item in datas %}
            DATAS.push('{{item}}');
            DAYS[i] = DATAS[i];
            i = i+1
        {%endfor%}
        {% for item in config.datasets.label %}
            c.push({{item.label}})
            i=i++
        {% endfor %}
        var config = {
            type: 'line',
            data: {
                labels: DAYS,
                datasets: [{
                    label: 'Remaining tasks',
                    fill: false,
                    backgroundColor: window.chartColors.blue,
                    borderColor: window.chartColors.blue,
                    data: dbRemaining,
                    date: [DATAS]
                }, {
                    label: 'bugs',
                    fill: false,
                    backgroundColor: window.chartColors.red,
                    borderColor: window.chartColors.red,
                    data: dbBugs,
                    date: [DATAS]
                }, {
                    label: 'extra',
                    fill: false,
                    backgroundColor: window.chartColors.yellow,
                    borderColor: window.chartColors.yellow,
                    data: dbExtras,
                    date: [DATAS]
                }, {
                    label: `improvements`,
                    fill: false,
                    backgroundColor: window.chartColors.green,
                    borderColor: window.chartColors.green,
                    data: dbImprovements,
                    date: [DATAS]
                }, {
                    label: `ideal`,
                    fill: false,
                    backgroundColor: window.chartColors.black,
                    borderColor: window.chartColors.black,
                    data: [],
                    date: [DATAS]
                }
            ]
            },
            options: {
                responsive: true,
                title: {
                    display: true,
                    text: 'Burndown'
                },
                tooltips: {
                    mode: 'index',
                    intersect: false,
                },
                hover: {
                    mode: 'nearest',
                    intersect: true
                },
                scales: {
                    xAxes: [{
                        display: true,
                        scaleLabel: {
                            display: false,
                            labelString: day.getDate() + '/' + day.getMonth() + '/' + day.getFullYear()
                        }
                    }],
                    yAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Tasks'
                        }
                    }]
                }
            }
        };
        var conf;
        {% set conf = config.data.labels %}
        
        
        window.onload = function () {
            var ctx = document.getElementById('canvas').getContext('2d');
            window.myLine = new Chart(ctx, config);
        };
        
        /*document.getElementById('submit').addEventListener('click', function () {
            var remaining = document.getElementById('remaining');
            var bugs = document.getElementById('bugs');
            var extra = document.getElementById('extra');
            var improvements = document.getElementById('improvements');
            config.data.datasets[0].data.push(remaining.value);
            config.data.datasets[1].data.push(bugs.value);
            config.data.datasets[2].data.push(extra.value);
            config.data.datasets[3].data.push(improvements.value);

            window.myLine.update();
        });
        */
        
    </script>

</body>
{% endblock %}